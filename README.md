# Miao 插件（astrbot_plugin_miao）

一个轻量的 AstrBot 插件，提供每日群打卡、批量点赞、前瞻兑换码抓取（附图）、TTS 语音生成、伪造聊天节点演示、以及检测“胡桃 + 链接”的管理员提醒等功能。

## 主要功能

- 每日群打卡与批量点赞（定时任务，默认在每天 `00:00` 执行）
- 批量为指定 QQ 号自动点赞（内部实现轮询调用机器人 `send_like`）
- 抓取 Bilibili 前瞻兑换码并附带封面图
- 根据第三方 TTS 接口生成语音并返回音频记录（`Record.fromURL`）
- 伪造聊天记录节点（用于演示）
- 监听包含“胡桃”且带 `http` 的消息并提醒管理员

## 安装

将本插件目录放入 AstrBot 的 `data/plugins/` 下，确保目录名为 `astrbot_plugin_miao`，重启 AstrBot 或通过插件管理加载该插件。

示例目录：
```
data/plugins/astrbot_plugin_miao/
  ├─ main.py
  └─ README.md
```

## 配置项（在插件或总配置中）

- `Master`：管理员 QQ（用于接收任务通知与控制保护），默认 `0` 表示未设置
- `send_like_list`：要自动点赞的 QQ 列表（数组），例如 `["12345678", "87654321"]`
- `yaohud_Api_list`：妖狐 TTS 服务的 API key 列表（数组），用于 `生成语音` 命令
- `HuTao_config`：收到“胡桃 + 链接”时要 @ 的管理员 QQ（若为 `0` 则不提醒）

注意：配置键名与插件内使用的键一致，请在 AstrBot 的配置文件中按需添加。

## 可用命令与行为

- `生成语音 <音色> <内容>`
  - 示例：`生成语音 胡桃 你好`。
  - 使用 `yaohud_Api_list` 中的 key 依次尝试请求 TTS 服务，成功后发送语音 `Record`。

- `前瞻兑换码 <游戏名>`
  - 示例：`前瞻兑换码 原神`。
  - 从 Bilibili 搜索前瞻动态，匹配标题并返回兑换码文本及封面图。若未找到则返回失败提示。

- `伪造聊天记录 <QQ号> <昵称> <内容>`
  - 示例：`伪造聊天记录 12345678 小明 你好`。
  - 会生成一个 `Node` 节点用于演示聊天记录（禁止伪造配置的 `Master` QQ）。

- 私聊或群聊消息 `赞我`
  - 会向发送者执行点赞操作（调用机器人接口），返回可读的回复文本。

- 自动监听包含“胡桃”且包含 `http` 的消息（正则 `(?=.*胡桃)(?=.*http)`）
  - 如果 `HuTao_config` 配置了管理员 QQ，会以 @ 的形式提醒管理员。

## 定时任务

插件在初始化时注册 APScheduler 的定时任务：

- `每天任务`：每天 `00:00` 执行 `checkin_task` 和 `like_task`，会将执行结果发送给 `Master`（若配置）。

## 依赖

- `aiohttp`（用于异步 HTTP 请求）
- `apscheduler`（用于定时任务）
- AstrBot 平台的核心接口（`AstrBot`、`Star`、`filter` 等）

请确保宿主环境已安装这些依赖并且插件运行在 AstrBot 支持的平台（例如 `aiocqhttp`）。

## 注意事项

- 该插件调用第三方 TTS 与 Bilibili 接口，网络请求可能失败或变更，出现异常时插件会记录日志。
- `send_like` 等接口受平台限流与权限影响，实际点赞数量与结果可能受限制。
- 请合理配置 `Master` 与 `send_like_list`，避免滥用接口造成账号风控。

## 授权

该插件为个人/社区插件，遵循项目中整体的授权条款。请在需要分发时保留原作者信息。
